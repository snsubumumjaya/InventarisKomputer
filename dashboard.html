<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>INVENTORY DATABASE</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <div class="container">
    “<div class="quote-left">“</div>
    <div class="header">
      <h1>Inventaris<br>Komputer</h1>
      <div>
        <span class="user-info" id="userInfo"></span>
        <button class="logout-btn" onclick="firebase.auth().signOut().then(()=>location.href='login.html')">LOGOUT</button>
      </div>
    </div>

    <div id="adminOnly" style="display:none">
      <button class="btn-add" onclick="showForm()">+ ADD NEW ASSET</button>
    </div>

    <div id="formInput" class="form" style="display:none">
      <h2 id="formTitle">ADD NEW ASSET</h2><br>
      <input type="text" id="kode" placeholder="ASSET CODE">
      <input type="text" id="merk" placeholder="BRAND">
      <input type="text" id="tipe" placeholder="MODEL / SPEC">
      <input type="text" id="lokasi" placeholder="LOCATION">
      <input type="text" id="status" placeholder="STATUS" value="OPERATIONAL">
      <br><br>
      <button class="btn-add" onclick="saveData()">SAVE TO DATABASE</button>
      <button style="background:none;border:1px solid #666;margin-left:20px;padding:15px 40px" onclick="document.getElementById('formInput').style.display='none'">CANCEL</button>
    </div>

    <table>
      <thead>
        <tr><th>CODE</th><th>BRAND</th><th>MODEL</th><th>LOCATION</th><th>STATUS</th><th id="aksiHeader" style="display:none">ACTION</th></tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
    <div class="quote-right">”</div>”
  </div>

  <div class="footer-text">SNSU BUMUM JAYA – INTERNAL INVENTORY SYSTEM 2025</div>

  <script>
    firebase.initializeApp({apiKey:"AIzaSyCGyH-yVAgQU4iJ1tIz3cpWiWa65BdMsJ8",authDomain:"inventariskomputer.firebaseapp.com",databaseURL:"https://inventariskomputer-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"inventariskomputer",storageBucket:"inventariskomputer.firebasestorage.app",messagingSenderId:"915927761008",appId:"1:915927761008:web:a4b2e71159d00501fdf4b5"});
    const auth = firebase.auth(); const db = firebase.database(); let role = 'staff'; let editingKey = null;

    auth.onAuthStateChanged(user => {
      if(!user) return location.href="login.html";
      db.ref('users/'+user.uid).once('value').then(s=> {
        const d = s.val(); role = d.role || 'staff';
        document.getElementById('userInfo').innerText = d.nama + " – " + role.toUpperCase();
        if(role==='admin'){document.getElementById('adminOnly').style.display='block';document.getElementById('aksiHeader').style.display='table-cell';}
      });

      db.ref('inventaris').on('value', snap => {
        const tbody = document.getElementById('tableBody'); tbody.innerHTML = '';
        if(!snap.exists()){tbody.innerHTML='<tr><td colspan="6" style="text-align:center;opacity:0.5;padding:100px">NO DATA AVAILABLE</td></tr>';return;}
        snap.forEach(child => {
          const item = child.val(); const key = child.key;
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${item.kode}</td><td>${item.merk}</td><td>${item.tipe}</td><td>${item.lokasi}</td><td>${item.status}</td>
            <td style="display:${role==='admin'?'':'none'}">
              <button class="btn-edit" onclick="editItem('${key}',${JSON.stringify(item)})">EDIT</button>
              <button class="btn-delete" onclick="if(confirm('DELETE THIS ASSET?'))db.ref('inventaris/${key}').remove()">DELETE</button>
            </td>`;
          tbody.appendChild(tr);
        });
      });
    });

    function showForm(){if(role!=='admin')return alert('ADMIN ONLY');editingKey=null;document.getElementById('formTitle').innerText='ADD NEW ASSET';document.getElementById('formInput').style.display='block';}
    function editItem(key,item){editingKey=key;document.getElementById('formTitle').innerText='EDIT ASSET';document.getElementById('formInput').style.display='block';document.getElementById('kode').value=item.kode;document.getElementById('merk').value=item.merk;document.getElementById('tipe').value=item.tipe;document.getElementById('lokasi').value=item.lokasi;document.getElementById('status').value=item.status;}
    function saveData(){if(role!=='admin')return;const data={kode:document.getElementById('kode').value,merk:document.getElementById('merk').value,tipe:document.getElementById('tipe').value,lokasi:document.getElementById('lokasi').value,status:document.getElementById('status').value};const key=editingKey||Date.now();db.ref('inventaris/'+key).set(data);document.getElementById('formInput').style.display='none';}
  </script>
</body>
</html>
